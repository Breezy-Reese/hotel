<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hotel Services</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    header { background: #007bff; color: #fff; padding: 1rem; text-align: center; }
    nav { background: #0056b3; display: flex; justify-content: center; flex-wrap: wrap; padding: 0.5rem; }
    nav a { color: #fff; text-decoration: none; margin: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: color 0.2s; }
    nav a:hover { color: #ffd700; }
    .section { margin: 2rem auto; max-width: 1000px; background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); display: none; }
    .section.active { display: block; }
    .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
    .card { border: 1px solid #ddd; padding: 1rem; border-radius: 8px; text-align: center; background: #fafafa; transition: transform 0.2s; }
    .card:hover { transform: scale(1.03); }
    .card img { width: 100%; height: 160px; object-fit: cover; border-radius: 6px; margin-bottom: 0.5rem; }
    .card h3 { margin: 0.5rem 0; color: #007bff; }
    .card p { margin: 0.3rem 0; color: #444; }
    .btn { background: #007bff; color: white; border: none; padding: 0.5rem 1rem; margin-top: 0.5rem; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .back-btn { background: #fff; color: #007bff; border: 1px solid #007bff; padding: 0.4rem 0.8rem; border-radius: 6px; cursor: pointer; margin-bottom: 1rem; font-size: 14px; transition: 0.3s; }
    .back-btn:hover { background: #007bff; color: #fff; }
    .booking-form { display: none; margin-top: 10px; text-align: left; border-top: 1px solid #ddd; padding-top: 10px; }
    .booking-form label { display: block; margin: 0.3rem 0 0.1rem; }
    .booking-form input { width: 100%; padding: 0.4rem; margin-bottom: 0.5rem; border-radius: 4px; border: 1px solid #ccc; }
  </style>
</head>
<body>
<header><h1>Our Hotel Services</h1></header>

<nav>
  <a onclick="showSection('restaurant-section')">Restaurant</a>
  <a onclick="showSection('gym-section')">Gym & Fitness</a>
  <a onclick="showSection('spa-section')">Spa & Wellness</a>
  <a onclick="showSection('conference-section')">Conference & Events</a>
  <a onclick="showSection('pool-section')">Swimming & Pool</a>
</nav>

<div class="section" id="restaurant-section">
  <button class="back-btn" onclick="goBack()">⬅ Back</button>
  <h2>Restaurant</h2>
  <div class="services" id="restaurant-items"></div>
</div>
<div class="section" id="gym-section">
  <button class="back-btn" onclick="goBack()">⬅ Back</button>
  <h2>Gym & Fitness</h2>
  <div class="services" id="gym-items"></div>
</div>
<div class="section" id="spa-section">
  <button class="back-btn" onclick="goBack()">⬅ Back</button>
  <h2>Spa & Wellness</h2>
  <div class="services" id="spa-items"></div>
</div>
<div class="section" id="conference-section">
  <button class="back-btn" onclick="goBack()">⬅ Back</button>
  <h2>Conference & Events</h2>
  <div class="services" id="conference-items"></div>
</div>
<div class="section" id="pool-section">
  <button class="back-btn" onclick="goBack()">⬅ Back</button>
  <h2>Swimming & Pool</h2>
  <div class="services" id="pool-items"></div>
</div>

<script>
const API_BASE = "https://hotel-system-75c6.onrender.com";

async function loadServices() {
  try {
    const res = await fetch(`${API_BASE}/services`);
    const data = await res.json();
    const services = data.services || [];

    ["restaurant-items","gym-items","spa-items","conference-items","pool-items"].forEach(id => {
      document.getElementById(id).innerHTML = "";
    });

    services.forEach(service => {
      const imgUrl = service.image || "/images/default.jpg";
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${imgUrl}" alt="${service.name}">
        <h3>${service.name}</h3>
        <p><strong>KES ${service.price || ''}</strong></p>
        <button class="btn" onclick="toggleForm(this)">Book & Pay</button>
        <form class="booking-form" onsubmit="submitBooking(event, '${service._id}')">
          <label>Name</label><input type="text" name="name" required>
          <label>Email</label><input type="email" name="email" required>
          <label>Phone</label><input type="text" name="phone" required>
          <label>Date & Time</label><input type="datetime-local" name="bookingDate" required>
          <button type="submit" class="btn">Confirm Booking</button>
        </form>
      `;

      const category = (service.category || "").toLowerCase();
      const containerId = 
        category.includes("restaurant") ? "restaurant-items" :
        category.includes("gym") ? "gym-items" :
        category.includes("spa") ? "spa-items" :
        (category.includes("conference") || category.includes("event")) ? "conference-items" :
        (category.includes("pool") || category.includes("swim")) ? "pool-items" : null;

      if(containerId) document.getElementById(containerId).appendChild(card);
    });

    showSection("restaurant-section");
  } catch(err) {
    console.error("Error loading services:", err);
  }
}

function toggleForm(button) {
  const form = button.nextElementSibling;
  form.style.display = form.style.display === "block" ? "none" : "block";
}

async function submitBooking(event, serviceId) {
  event.preventDefault();
  const form = event.target;

  const data = {
    serviceId,
    name: form.name.value,
    email: form.email.value,
    phone: form.phone.value,
    bookingDate: new Date(form.bookingDate.value).toISOString()
  };

  try {
    const res = await fetch(`${API_BASE}/book-service`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if(result.success){
      alert("Booked successfully!");
      form.reset();
      form.style.display = "none";
    } else {
      alert("Booking failed: " + result.message);
    }
  } catch(err) {
    console.error("Booking error:", err);
    alert("Booking failed: " + err.message);
  }
}

function showSection(sectionId) {
  document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
  document.getElementById(sectionId).classList.add("active");
}

function goBack() { window.location.href = "index.html"; }

loadServices();
</script>
</body>
</html>
